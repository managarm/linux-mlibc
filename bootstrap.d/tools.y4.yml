sources:
  - name: autoconf-archive
    subdir: ports
    git: 'https://github.com/autoconf-archive/autoconf-archive.git'
    tag: 'v2019.01.06'
    version: '2019.01.06'

  - name: autoconf-v2.69
    subdir: ports
    url: 'https://ftpmirror.gnu.org/gnu/autoconf/autoconf-2.69.tar.xz'
    format: 'tar.xz'
    extract_path: 'autoconf-2.69'
    version: '2.69'

  - name: automake-v1.15
    subdir: ports
    git: 'https://git.savannah.gnu.org/git/automake.git'
    tag: 'v1.15.1'
    version: '1.15.1'
    tools_required:
      - cross-autoconf-v2.69
    regenerate:
      - args: ['./bootstrap']

  - name: libtool
    subdir: 'ports'
    git: 'https://https.git.savannah.gnu.org/git/libtool.git'
    tag: 'v2.5.4'
    version: '2.5.4'
    sources_required:
      - gnulib
    tools_required:
      - cross-autoconf-v2.69
      - cross-automake-v1.15
    regenerate:
      - args: ['git', 'submodule', 'deinit', 'gnulib']
      - args: ['python3', '@SOURCE_ROOT@/scripts/checkout-gnulib.py', '@SOURCE_ROOT@/ports/gnulib']
      - args: ['./bootstrap', '--gnulib-srcdir=gnulib', '--skip-git']
        isolate_network: false
      - args: ['cp',
          '@BUILD_ROOT@/tools/cross-automake-v1.15/share/automake-1.15/config.sub',
          '@THIS_SOURCE_DIR@/build-aux/']
      - args: ['cp',
          '@BUILD_ROOT@/tools/cross-automake-v1.15/share/automake-1.15/config.guess',
          '@THIS_SOURCE_DIR@/build-aux/']

tools:
  - name: cross-autoconf-archive
    architecture: '@OPTION:arch@'
    from_source: autoconf-archive
    exports_aclocal: true
    revision: 1
    install:
      - args: ['mkdir', '-p', '@BUILD_ROOT@/tools/cross-autoconf-archive/share/']
      - args: ['cp', '-r', '@THIS_SOURCE_DIR@/m4', '@BUILD_ROOT@/tools/cross-autoconf-archive/share/aclocal']

  - name: cross-autoconf-v2.64
    labels: [aarch64]
    architecture: noarch
    source:
      name: autoconf-v2.64
      subdir: 'ports'
      url: 'https://ftpmirror.gnu.org/gnu/autoconf/autoconf-2.64.tar.xz'
      format: 'tar.xz'
      checksum: blake2b:598873209a67725150cd4cf09c4b78b26b3d1782f259846da48dc8106a1d32ae2b24f3a864c3be0e9e8dc7d6b6ca8781b83ff33a691c88e68391d1ea861ccf23
      extract_path: 'autoconf-2.64'
      version: '2.64'
    revision: 1
    configure:
      # Despite its efforts to be POSIX-compatible, autoconf 2.64 fails to configure on dash
      # (as it assumes that echo does not evaluate backslash escapes).
      # It *also* fails when setting CONFIG_SHELL to /bin/bash.
      # The manual (in section "Defining Variables") mentions this bug and the following
      # workaround: We set *both* CONFIG_SHELL *and* execute the script using /bin/bash.
      - args: ['/bin/bash', '@THIS_SOURCE_DIR@/configure', '--prefix=@PREFIX@']
        environ:
          'CONFIG_SHELL': '/bin/bash'
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']

  - name: cross-autoconf-v2.69
    architecture: '@OPTION:arch@'
    from_source: autoconf-v2.69
    revision: 1
    configure:
      - args: ['@THIS_SOURCE_DIR@/configure', '--prefix=@PREFIX@']
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']

  - name: cross-autoconf-v2.71
    labels: [aarch64, riscv64]
    architecture: noarch
    source:
      name: autoconf-v2.71
      subdir: 'ports'
      git: 'https://https.git.savannah.gnu.org/git/autoconf.git'
      tag: 'v2.71'
      version: '2.71'
      sources_required:
        - gnuconfig
        - gnulib
      tools_required:
        - cross-autoconf-v2.69
        - cross-automake-v1.15
      regenerate:
        - args: ['cp', '@SOURCE_ROOT@/ports/gnuconfig/config.sub', '@THIS_SOURCE_DIR@/lib/']
        - args: ['cp', '@SOURCE_ROOT@/ports/gnuconfig/config.guess', '@THIS_SOURCE_DIR@/lib/']
        - args: ['python3', '@SOURCE_ROOT@/scripts/checkout-gnulib.py', '@SOURCE_ROOT@/ports/gnulib']
        - args: ['autoreconf', '-fvi']
    revision: 1
    configure:
      - args: ['@THIS_SOURCE_DIR@/configure', '--prefix=@PREFIX@']
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']

  - name: cross-automake-v1.11
    labels: [aarch64, riscv64]
    architecture: noarch
    source:
      name: automake-v1.11
      subdir: 'ports'
      git: 'https://https.git.savannah.gnu.org/git/automake.git'
      tag: 'v1.11.6'
      version: '1.11.6'
      sources_required:
        - gnuconfig
        - gnulib
      tools_required:
        - cross-autoconf-v2.69
      regenerate:
        - args: ['cp', '@SOURCE_ROOT@/ports/gnuconfig/config.sub', '@THIS_SOURCE_DIR@/lib/']
        - args: ['cp', '@SOURCE_ROOT@/ports/gnuconfig/config.guess', '@THIS_SOURCE_DIR@/lib/']
        - args: ['python3', '@SOURCE_ROOT@/scripts/checkout-gnulib.py', '@SOURCE_ROOT@/ports/gnulib']
        - args: ['./bootstrap']
    tools_required:
      - cross-autoconf-v2.69
    revision: 1
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--prefix=@PREFIX@'
        - 'MAKEINFO=/bin/true'
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']
      # Stop aclocal from complaining.
      - args: ['ln', '-sf', '@PREFIX@/share/aclocal-1.11', '@PREFIX@/share/aclocal']

  - name: cross-automake-v1.15
    architecture: '@OPTION:arch@'
    from_source: automake-v1.15
    tools_required:
      - cross-autoconf-v2.69
    revision: 1
    configure:
      - args: ['@THIS_SOURCE_DIR@/configure', '--prefix=@PREFIX@', 'MAKEINFO=/bin/true']
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']
      - args: ['ln', '-sf', '@PREFIX@/share/aclocal-1.15', '@PREFIX@/share/aclocal']

  - name: cross-libtool
    architecture: '@OPTION:arch@'
    exports_aclocal: true
    from_source: libtool
    tools_required:
      - cross-autoconf-v2.69
      - cross-automake-v1.15
    revision: 1
    configure:
      - args: ['@THIS_SOURCE_DIR@/configure', '--prefix=@PREFIX@']
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']
